resources:
  subject:
    attributes:
    - id: id
    - id: role
    - id: branchIds
    - id: maxOrderAmount
      type: int
  order:
    title: Order
    actions:
    - edit
    - view
    - create
    - approve
    - reject
    attributes:
    - id: id
    - id: amount
      type: int
    - id: branchId
    - id: state
    - id: customer

  customer:
    title: Customer
    attributes:
    - id: id
    - id: branchId

permissions:
- title: Any User
  accessToActions: [order.view]
  rules:
  - title: Any user of branch
    operation: AND
    conditions:
    - order.branchId in subject.branchIds

- title: Operator
  accessToActions: [order.create]
  rules:
  - title: Operator create
    operation: AND
    conditions:
    - customer.branchId == subject.branchIds
    - order.branchId == subject.branchIds
    - subject.role == 'OPERATOR'

- title: Operator
  accessToActions: [order.edit]
  rules:
  - title: operator of branch and order.status=new
    operation: AND
    conditions:
    - order.branchId in subject.branchIds
    - subject.role == 'OPERATOR'
    - order.state == 'NEW'

- title: Manager
  accessToActions: [order.approve, order.reject]
  rules:
  - title: Manager access
    operation: AND
    conditions:
    - order.branchId in subject.branchIds
    - subject.role == 'MANAGER'
    - subject.maxOrderAmount > order.amount